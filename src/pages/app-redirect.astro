---
// src/pages/app-redirect.astro
---

<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width' />
    <title>Redirecting to App Store</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        text-align: center;
        padding: 2rem;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 2rem auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <h1>Redirecting you to download the app...</h1>
    <div class='loader'></div>
    <p id='message'>Please wait...</p>

    <script>
      // App store URLs
      const IOS_APP_URL = 'https://apps.apple.com/pl/app/jingle-pay/id1493392189';
      const ANDROID_APP_URL = 'https://play.google.com/store/apps/details?id=com.jinglepay&hl=en';
      const FALLBACK_URL = 'http://jinglepay-website-dev.s3-website.me-central-1.amazonaws.com/pak/en/PK/en/'; // Fallback for desktop or unknown

      function detectOS() {
        const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;

        // iOS detection
        if (/iPad|iPhone|iPod/.test(userAgent) && !(window as any).MSStream) {
          return 'iOS';
        }

        // Android detection
        if (/android/i.test(userAgent)) {
          return 'Android';
        }

        // Default to desktop/unknown
        return 'other';
      }

      function redirect() {
        const os = detectOS();
        let redirectURL = FALLBACK_URL;
        let message = 'Redirecting to download page...';

        if (os === 'iOS') {
          redirectURL = IOS_APP_URL;
          message = 'Redirecting to App Store...';
        } else if (os === 'Android') {
          redirectURL = ANDROID_APP_URL;
          message = 'Redirecting to Google Play Store...';
        }

        const messageElement = document.getElementById('message');

        if (messageElement) {
          messageElement.innerText = message;
        }

        window.location.href = redirectURL;
      }

      // Execute redirect when page loads
      window.onload = redirect;
    </script>
  </body>
</html>
