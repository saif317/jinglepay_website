---
import DownloadAppButton from '@components/hero-section/DownloadAppButton.astro';

import '@styles/global.css';
---

<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width' />
    <title>Redirecting...</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        text-align: center;
        padding: 2rem;
      }
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 2rem auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      #download-buttons {
        display: none;
        margin-top: 2rem;
      }
      h1 {
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>Redirecting you...</h1>
    <div class='loader'></div>
    <p id='message'>Please wait...</p>

    <div id='download-buttons'>
      <DownloadAppButton />
    </div>

    <script>
      const IOS_APP_URL = 'https://apps.apple.com/pl/app/jingle-pay/id1493392189';
      const ANDROID_APP_URL = 'https://play.google.com/store/apps/details?id=com.jinglepay&hl=en';

      function detectOS() {
        const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;

        if (/iPad|iPhone|iPod/.test(userAgent) && !(window as any).MSStream) {
          return 'iOS';
        }

        if (/android/i.test(userAgent)) {
          return 'Android';
        }

        return 'other';
      }

      function handleRedirectOrShowButton() {
        const os = detectOS();
        const messageElement = document.getElementById('message');
        const loaderElement = document.querySelector('.loader');
        const headingElement = document.querySelector('h1');
        const downloadButtonContainer = document.getElementById('download-buttons');

        if (os === 'iOS') {
          const redirectURL = IOS_APP_URL;
          const message = 'Redirecting to App Store...';
          if (messageElement) messageElement.innerText = message;
          window.location.href = redirectURL;
        } else if (os === 'Android') {
          const redirectURL = ANDROID_APP_URL;
          const message = 'Redirecting to Google Play Store...';
          if (messageElement) messageElement.innerText = message;
          window.location.href = redirectURL;
        } else {
          document.title = 'Download the Jingle Pay App';
          if (headingElement) headingElement.innerText = 'Download Our App';
          if (loaderElement) loaderElement.style.display = 'none';
          if (messageElement) messageElement.style.display = 'none';
          if (downloadButtonContainer) downloadButtonContainer.style.display = 'block';
        }
      }

      window.onload = handleRedirectOrShowButton;
    </script>
  </body>
</html>
