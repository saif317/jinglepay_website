---
import QRCodeGenerator from '@components/common/QRCodeGenerator.astro';
import QRModalTriggerer from '@components/common/QRModalTriggerer.astro';

const {
  translations: { cta = {} },
  country, // Get the current country from Astro.locals
} = Astro.locals;

// Check if we're on the UAE site
const isUAE = country === 'are';
---

<div class='my-[40px] lg:mt-[100px] lg:mb-[134px] px-4 sm:px-8 md:px-12 lg:px-16'>
  <div
    class={`text-white pt-[32px] pb-[40px] px-[12px] gap-y-[40px] flex flex-col items-center lg:gap-y-[45px] lg:pt-[47px] lg:pb-[33px] lg:px-[87px] ${isUAE ? 'bg-neutral-800' : 'bg-indigo-950'} rounded-xl`}
  >
    <div class='flex flex-col items-center text-center gap-y-4'>
      <span class='text-lg font-bold lg:text-2xl xl:text-3xl'>{cta.title}</span>
      <span class='text-xl font-bold lg:text-4xl'>{cta.subtitle}</span>
      <span class='text-sm font-normal lg:text-xl'>{cta.text}</span>
    </div>

    <div class='hidden lg:block'>
      <QRModalTriggerer>
        <div class='flex flex-row gap-x-2.5 items-center py-3 pr-1.5 pl-4 rounded-xl border border-white'>
          <QRCodeGenerator baseGenerationSize={32} />
          <span class='text-lg font-bold text-white'>{cta.qrText}</span>
        </div>
      </QRModalTriggerer>
    </div>

    <div class='block px-9 lg:hidden'>
      <button
        id='cta-download-sm'
        type='button'
        onclick='triggerAppRedirect(event)'
        class='block w-full cursor-pointer px-4 py-2 text-xs font-medium text-[#1E1A4D] transition-colors duration-300 bg-white rounded-xl lg:text-base hover:bg-gray-200'
        >{cta.downloadApp}</button
      >
    </div>
  </div>
</div>

<script>
  import { triggerAppRedirect } from '@util/handleAppRedirect';
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('cta-download-sm');
    if (btn) {
      btn.addEventListener('click', (e) => triggerAppRedirect(e));
    }
  });
  // Expose globally for inline onclick fallback
  window.triggerAppRedirect = triggerAppRedirect;
</script>
