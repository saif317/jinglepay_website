---
import PhoneNumberInput from '@components/common/PhoneNumberInput.astro';
import QRCodeGenerator from '@components/common/QRCodeGenerator.astro';

declare global {
  interface Window {
    openQRModal: () => void;
  }
}
---

<!-- Global QR Modal (included once) -->
<div id='global-qr-modal' class='fixed inset-0 z-50 items-center justify-center bg-[#00000050] hidden'>
  <div class='relative flex flex-col items-center justify-center w-full h-full text-center bg-white shadow-sm gap-y-4'>
    <!-- Close button -->
    <button id='global-qr-modal-close' class='absolute cursor-pointer text-gray-500 right-4 top-4 hover:text-[#794eff]'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'></path>
      </svg>
    </button>

    <h3 class='flex items-center justify-between text-xl font-extrabold'>Get the Jingle Pay App</h3>
    <span class='text-sm font-light'>Scan the QR code to download the App</span>

    <div class='flex justify-center'>
      <QRCodeGenerator />
    </div>

    <span class='text-sm font-light'>or get a download link via SMS</span>
    <PhoneNumberInput class='' />
  </div>
</div>

<script>
  // Define global function to open modal
  window.openQRModal = () => {
    const modal = document.getElementById('global-qr-modal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    }
  };

  // Set up event listeners (only once)
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('global-qr-modal');
    const closeButton = document.getElementById('global-qr-modal-close');

    // Close modal when close button is clicked
    closeButton?.addEventListener('click', () => {
      modal?.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    });

    // Close modal when clicking outside modal content
    modal?.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
      }
    });

    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
      }
    });
  });
</script>
