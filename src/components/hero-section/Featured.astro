---
// Import Swiper styles
// import 'swiper/css'; // Core Swiper styles are included in swiper-bundle.min.css

import FinextraLogo from '@assets/featured-in/finextra-logo.svg';
import PaypersLogo from '@assets/featured-in/paypers.svg';
import FintechTimesLogo from '@assets/featured-in/fintech-times.svg';
import ArabNews from '@assets/featured-in/arab-news.svg';
import Zawya from '@assets/featured-in/zawya.svg';
import Pymnts from '@assets/featured-in/pymnts.svg';
import IbsiHorizTagLogoColor1 from '@assets/featured-in/ibsi-horiz-tag-logo-color 1.svg';
import Image8 from '@assets/featured-in/image 8.svg';
import Image9 from '@assets/featured-in/image 9.svg';
import Image10 from '@assets/featured-in/image 10.svg';
import Image11 from '@assets/featured-in/image 11.svg';
import Image12 from '@assets/featured-in/image 12.svg';
import Image13 from '@assets/featured-in/image 13.svg';
import Image14 from '@assets/featured-in/image 14.svg';
import Image15 from '@assets/featured-in/image 15.svg';
import Image16 from '@assets/featured-in/image 16.svg';
import Image17 from '@assets/featured-in/image 17.svg';
import Image18 from '@assets/featured-in/image 18.svg';
import Image19 from '@assets/featured-in/image 19.svg';
import Image21 from '@assets/featured-in/image 21.svg';
import Image22 from '@assets/featured-in/image 22.svg';
import Image23 from '@assets/featured-in/image 23.svg';
import Image24 from '@assets/featured-in/image 24.svg';
import Image25 from '@assets/featured-in/image 25.svg';
import Image26 from '@assets/featured-in/image 26.svg';
import Image27 from '@assets/featured-in/image 27.svg';
import Image28 from '@assets/featured-in/image 28.svg';
import Image29 from '@assets/featured-in/image 29.svg';
import Image30 from '@assets/featured-in/image 30.svg';
import Image31 from '@assets/featured-in/image 31.svg';
import Image32 from '@assets/featured-in/image 32.svg';
import Image33 from '@assets/featured-in/image 33.svg';
import Image34 from '@assets/featured-in/image 34.svg';
import Image35 from '@assets/featured-in/image 35.svg';
import Image36 from '@assets/featured-in/image 36.svg';
import ImageLast from '@assets/featured-in/image last.svg';

const logos = [
  {
    href: 'https://www.pymnts.com/financial-inclusion-3/2022/jingle-pay-launches-mastercard-for-unbanked-uae-residents/',
    src: Pymnts,
    alt: 'Pymnts',
  },
  {
    href: 'https://thepaypers.com/search/index.aspx?search=jingle+pay',
    src: PaypersLogo,
    alt: 'The Paypers',
    class: 'grayscale',
  },
  {
    href: 'https://www.finextra.com/pressarticle/95078/jingle-pay-unlocks-mastercards-network-of-90-million-global-merchants-for-its-users',
    src: FinextraLogo,
    alt: 'Finextra',
  },
  {
    href: 'https://www.arabnews.pk/tags/bank-alfalah',
    src: ArabNews,
    alt: 'Arab News',
  },
  {
    href: 'https://www.zawya.com/en/press-release/jingle-pay-brings-instant-money-transfers-and-global-remittances-to-migrant-workers-uyj68p9j',
    src: Zawya,
    alt: 'Zawya',
  },
  {
    href: 'https://thefintechtimes.com/?s=%22jingle+pay%22',
    src: FintechTimesLogo,
    alt: 'The Fintech Times',
  },
  // {
  //   href: 'https://ibsintelligence.com/ibsi-news/jingle-pay-the-first-money-service-business-with-shariah-certification/',
  //   src: IbsiHorizTagLogoColor1,
  //   alt: 'Ibsi Horiz Tag Logo Color 1',
  // },
  {
    href: 'https://fintech.global/2025/01/13/bank-alfalah-invests-in-uae-fintech-jingle-pay-to-drive-digital-transformation/',
    src: Image8,
    alt: 'Image 8',
  },
  {
    href: 'https://www.fintechfutures.com/m-a/jingle-pay-to-launch-in-pakistan-as-bank-alfalah-acquires-9-9-stake',
    src: Image9,
    alt: 'Image 9',
  },
  {
    href: 'https://www.mastercard.com/news/eemea/en/newsroom/press-releases/en/2022/november/jingle-pay-partners-with-mastercard-to-boost-financial-inclusion/',
    src: Image10,
    alt: 'Image 10',
  },
  {
    href: 'https://www.banking-gateway.com/news/bank-alfalah-acquires-stake-in-uae-based-fintech-company-jingle-pay/?cf-view',
    src: Image11,
    alt: 'Image 11',
  },
  // {
  //   href: 'https://www.prnewswire.com/news-releases/bank-alfalah-acquires-strategic-stake-in-uae-fintech-jingle-pay-302347233.html',
  //   src: Image12,
  //   alt: 'Image 12',
  // },
  // {
  //   href: 'https://www.electronicpaymentsinternational.com/news/bank-alfalah-acquires-stake-in-uae-fintech-jingle-pay/?cf-view&Top-Article-Share-Button-clicked:%20Copy%20Link',
  //   src: Image13,
  //   alt: 'Image 13',
  // },
  {
    href: 'https://ffnews.com/newsarticle/jingle-pay-the-financial-super-app-announces-a-strategic-partnership-and-a-minority-investment-from-moneygram/',
    src: Image14,
    alt: 'Image 14',
  },
  {
    href: 'https://fintechnews.ae/13502/fintechdubai/moneygram-acquires-12-stake-in-uae-mobile-payment-app-jingle-pay/',
    src: Image15,
    alt: 'Image 15',
  },
  // {
  //   href: 'https://itdigest.com/fintech/jingle-pay-the-financial-super-app-announces-a-strategic-partnership-and-a-minority-investment-from-moneygram/',
  //   src: Image16,
  //   alt: 'Image 16',
  // },
  // {
  //   href: 'https://www.streetinsider.com/PRNewswire/Jingle+Pay%2C+the+Financial+Super-App%2C+Announces+a+Strategic+Partnership+and+a+Minority+Investment+from+MoneyGram/20671938.html',
  //   src: Image17,
  //   alt: 'Image 17',
  // },
  // {
  //   href: 'https://www.einpresswire.com/article/595178055/jingle-pay-the-financial-super-app-set-to-launch-in-bahrain-in-collaboration-with-afs',
  //   src: Image18,
  //   alt: 'Image 18',
  // },
  // {
  //   href: 'https://www.finsmes.com/2025/01/bank-alfalah-acquires-minority-stake-in-jingle-pay.html',
  //   src: Image19,
  //   alt: 'Image 19',
  // },
  {
    href: 'https://www.qorusglobal.com/content/18003-jingle-pay-the-financial-super-app-set-to-launch-in-bahrain-in-collaboration-with-afs',
    src: Image21,
    alt: 'Image 21',
  },
  {
    href: 'https://regtechafrica.com/jingle-pay-to-launch-neobank-in-the-uae/',
    src: Image22,
    alt: 'Image 22',
  },
  {
    href: 'https://www.wamda.com/2025/01/bank-alfalah-invests-uae-fintech-jingle-pay-9-9-stake',
    src: Image23,
    alt: 'Image 23',
  },
  {
    href: 'https://www.nasdaq.com/press-release/jingle-pay-the-financial-super-app-announces-a-strategic-partnership-and-a-minority',
    src: Image24,
    alt: 'Image 24',
  },
  {
    href: 'https://finance.yahoo.com/news/bank-alfalah-acquires-stake-uae-111640064.html?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAN2Lh9I37lOJASa9rEj7e9ONfhsCM3WjqdugsMatN2eRHC-uqXwi_PPQBN6VTDcKzU4TaNMZYxQB4gY0CF2fOAQ8etv4umoKZPYFfi_oL-q9n7DwGFVaqXJrts1TrU5h9GetSHJo6QwDKr4iHUdjMa9ZGqULgub56j_5sKfrGFjQ',
    src: Image25,
    alt: 'Image 25',
  },
  {
    href: 'https://www.sme10x.com/everything-finance/jingle-pay-gets-shariah-certification',
    src: Image26,
    alt: 'Image 26',
  },
  // {
  //   href: 'https://www.seedstars.com/community/entrepreneurs/programs/seedstars-international-growth-program-8/jingle-pay/',
  //   src: Image27,
  //   alt: 'Image 27',
  // },
  {
    href: 'https://www.arabnews.com/node/2586251/amphttps://www.arabnews.com/node/2586251/amp',
    src: Image28,
    alt: 'Image 28',
  },
  // {
  //   href: 'https://incubees.com/uae-fintech-jingle-pay-receives-investment-from-bank-alfalah-for-9-9-stake/',
  //   src: Image29,
  //   alt: 'Image 29',
  // },
  {
    href: 'https://paymentexpert.com/2025/01/13/bank-alfalah-buys-jingle-pay-stake/',
    src: Image30,
    alt: 'Image 30',
  },
  {
    href: 'https://www.fullcircl.com/press-release/neobank-jingle-pay-chooses-w2-to-power-its-new-super-app',
    src: Image31,
    alt: 'Image 31',
  },
  {
    href: 'https://en.arageek.com/bank-alfalahs-bold-move-investing-in-uaes-jingle-pay-to-transform-digital-banking-in-menap',
    src: Image32,
    alt: 'Image 32',
  },
  {
    href: 'https://thearabianpost.com/bank-alfalah-expands-reach-with-stake-in-jingle-pay/',
    src: Image33,
    alt: 'Image 33',
  },
  {
    href: 'https://mea-finance.com/jingle-pay-partners-with-mastercard-to-boost-financial-inclusion/',
    src: Image34,
    alt: 'Image 34',
  },
  {
    href: 'https://thepaymentsassociation.org/article/neobank-jingle-pay-chooses-w2-to-power-its-new-super-app-for-the-unbanked/',
    src: Image35,
    alt: 'Image 35',
  },
  {
    href: 'https://globalfintechseries.com/news/dubai-startup-jingle-pay-targets-the-middle-east-with-digital-neobanking-services/',
    src: Image36,
    alt: 'Image 36',
  },
  // {
  //   href: 'https://brandsreviewmagazine.com/news/bank-alfalah-acquires-strategic-stake-in-uae-fintech-jingle-pay/',
  //   src: ImageLast,
  //   alt: 'Image Last',
  // },
];

const { translations = {} } = Astro.locals;
---

<section
  class='flex flex-col gap-y-4 items-center px-4 pt-12 pb-16 mx-auto w-full text-center md:pt-16 bg-[#F6F6F6]'
  id='featured-section'
>
  <h2 class='text-lg lg:text-xl'>{translations.featuredIn}</h2>

  <div class='w-full logo-carousel-container' id='logoCarouselContainer'>
    <div class='flex logo-carousel-track' id='logoCarouselTrack'>
      {
        logos.map((logo) => (
          <div class='logo-item'>
            <a
              href={logo.href}
              target='_blank'
              rel='noopener noreferrer'
              class='inline-block transition-opacity duration-300 hover:opacity-75'
              aria-label={`Featured in ${logo.alt}`}
              draggable='false'
            >
              <logo.src class={logo.class} />
            </a>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('logoCarouselContainer');
    const track = document.getElementById('logoCarouselTrack');

    if (!container || !track) {
      console.error('Carousel container or track not found!');
      return;
    }

    const originalItems = Array.from(track.children);
    if (originalItems.length === 0) return; // No logos to animate

    let animationFrameId;
    let currentX = 0;
    const scrollSpeedPxPerFrame = 0.5; // Adjust for desired speed (e.g., 0.5px per frame)
    let isPaused = false;
    let singleSetWidth = 0;

    // --- Drag/Swipe Functionality State ---
    let isDragging = false;
    let dragStartX = 0;
    let dragInitialTrackX = 0;
    let wasDragged = false; // Track if actual movement occurred during drag

    // Calculate the width of a single set of original logos
    originalItems.forEach((item) => {
      const style = window.getComputedStyle(item);
      singleSetWidth += item.offsetWidth + parseFloat(style.marginLeft) + parseFloat(style.marginRight);
    });

    function cloneAndArrangeLogos() {
      // Clear existing clones if any (e.g., on resize, though not handled here yet)
      const clones = track.querySelectorAll('.clone');
      clones.forEach((clone) => clone.remove());

      // Add clones until the track is wide enough for seamless looping
      // We want the track to be at least wide enough that when the original set is off-screen,
      // clones are still filling the viewport.
      // A common strategy is to ensure the track width is at least singleSetWidth + container.offsetWidth
      // Or simply, clone the set once or twice.
      let currentTrackWidth = singleSetWidth;
      // Ensure singleSetWidth is calculated and positive before cloning
      if (singleSetWidth > 0 && container.offsetWidth > 0) {
        while (currentTrackWidth < singleSetWidth + container.offsetWidth * 1.5) {
          // Ensure enough clones
          originalItems.forEach((item) => {
            const clone = item.cloneNode(true);
            clone.classList.add('clone');
            track.appendChild(clone);
            const style = window.getComputedStyle(clone);
            currentTrackWidth += clone.offsetWidth + parseFloat(style.marginLeft) + parseFloat(style.marginRight);
          });
        }
      }
    }

    function animate() {
      if (!isPaused && !isDragging) {
        currentX -= scrollSpeedPxPerFrame;
        // Only loop if singleSetWidth is positive (i.e., logos are present and measured)
        if (singleSetWidth > 0 && Math.abs(currentX) >= singleSetWidth) {
          currentX += singleSetWidth; // Add back one set width to loop smoothly
        }
        track.style.transform = `translateX(${currentX}px)`;
      }
      animationFrameId = requestAnimationFrame(animate);
    }

    // --- Event Listeners for Pause/Resume (Hover & Tap) ---
    container.addEventListener('mouseenter', () => {
      isPaused = true;
    });

    container.addEventListener('mouseleave', () => {
      // If not currently dragging (e.g., mouse released outside), then resume autoplay
      if (!isDragging) {
        isPaused = false;
      }
    });

    // `touchstart` on container is now primarily for initiating drag,
    // immediate pause is handled by onDragStart setting isPaused = true.
    // A simple tap (touchstart then touchend quickly without move) will also pause then resume.

    // `touchend` on container - if a drag didn't occur, this signals end of a tap
    container.addEventListener('touchend', () => {
      // If isDragging is false, it means this touchend is not the end of a drag,
      // but potentially the end of a 'tap'. If it was a tap, and the finger is now up, we can allow autoplay to resume.
      if (!isDragging) {
        isPaused = false;
      }
      // If it WAS a drag, the onDragEnd on the document will handle isDragging and isPaused state.
    });

    // --- Event Listeners for Drag/Swipe ---
    function getEventX(event) {
      return event.touches ? event.touches[0].clientX : event.clientX;
    }

    function onDragStart(event) {
      isPaused = true; // Pause autoplay during drag
      isDragging = true;
      wasDragged = false; // Reset drag state when starting a new drag
      dragStartX = getEventX(event);
      dragInitialTrackX = currentX; // Use currentX as the source of truth for initial track position

      track.style.transition = 'none'; // No CSS transitions during drag
      container.classList.add('is-dragging');
      container.style.cursor = 'grabbing';
      // Prevent default for touchstart to effectively override tap-pause if drag starts
      if (event.type === 'touchstart') {
        // No explicit preventDefault here to allow link clicks if not dragging
        // but onDragMove will preventDefault if movement occurs
      }
    }

    function onDragMove(event) {
      if (!isDragging) return;

      const currentEventX = getEventX(event);
      const deltaX = currentEventX - dragStartX;

      // Only mark as dragged if there was significant movement (to distinguish from minor unintentional movement)
      if (Math.abs(deltaX) > 5) {
        wasDragged = true;
      }

      // Prevent page scroll only if there's actual movement
      if (event.type === 'touchmove') {
        event.preventDefault();
      }

      currentX = dragInitialTrackX + deltaX;
      track.style.transform = `translateX(${currentX}px)`;
    }

    function onDragEnd(event) {
      // event can be mouseup or touchend
      if (!isDragging) return; // Only process if a drag was actually happening

      // Store the drag state before resetting isDragging
      const dragOccurred = wasDragged;

      isDragging = false;
      container.classList.remove('is-dragging');
      container.style.cursor = 'grab';
      track.style.transition = ''; // Restore transitions if any (not strictly needed for RAF)

      // Normalize currentX to keep it within one scroll cycle for loop consistency
      if (singleSetWidth > 0) {
        currentX = currentX % singleSetWidth;
        if (currentX > 0) {
          currentX -= singleSetWidth;
        }
      }
      track.style.transform = `translateX(${currentX}px)`; // Snap to normalized position

      // Determine if autoplay should resume based on mouse position or if it was a touch end
      const eventType = event.type;
      if (eventType === 'mouseup') {
        // Check if mouse is still over the container
        const rect = container.getBoundingClientRect();
        const clientX = event.clientX;
        const clientY = event.clientY;
        if (clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom) {
          // Mouse is still inside, isPaused remains true (due to mouseenter)
          // If user wants it to resume, they need to mouseleave and re-enter or just mouseleave.
        } else {
          // Mouse was released outside the container, so resume autoplay
          isPaused = false;
        }
      } else if (eventType === 'touchend') {
        // For touchend, typically resume autoplay immediately
        isPaused = false;
      }
    }

    container.addEventListener('mousedown', onDragStart);
    // For touchstart on container, we want to allow link clicks if no drag occurs.
    // The drag is initiated by onDragStart. If it was a tap, touchend on container handles resume.
    container.addEventListener('touchstart', onDragStart, { passive: false }); // passive: false allows preventDefault in onDragMove

    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('touchmove', onDragMove, { passive: false });

    document.addEventListener('mouseup', onDragEnd);
    document.addEventListener('touchend', onDragEnd);

    // Prevent link clicks after drag
    container.addEventListener(
      'click',
      function (event) {
        if (wasDragged) {
          event.preventDefault();
          event.stopPropagation();
          wasDragged = false; // Reset for the next interaction
        }
      },
      true
    ); // Use capture phase to intercept the event before it bubbles

    // Initial cursor style
    container.style.cursor = 'grab';

    // --- Initial Setup & Start ---
    cloneAndArrangeLogos();
    animate();

    // Optional: Handle resize to re-calculate and re-clone if layout changes significantly
    // window.addEventListener('resize', () => {
    //   // May need to recalculate singleSetWidth and call cloneAndArrangeLogos again
    //   // and potentially adjust currentX if it becomes invalid.
    //   // For now, keeping it simple.
    //   cancelAnimationFrame(animationFrameId);
    //   singleSetWidth = 0;
    //   originalItems.forEach(item => {
    //     const style = window.getComputedStyle(item);
    //     singleSetWidth += item.offsetWidth + parseFloat(style.marginLeft) + parseFloat(style.marginRight);
    //   });
    //   cloneAndArrangeLogos();
    //   animate(); // Restart animation
    // });
  });
</script>

<style is:global>
  .logo-carousel-container {
    overflow: hidden;
    /* Optional: Add a mask for fading edges if desired */
    /* -webkit-mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent); */
    /* mask-image: linear-gradient(to right, transparent, black 20%, black 80%, transparent); */
  }

  .logo-carousel-container.is-dragging {
    user-select: none; /* Prevent text selection during drag */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }

  .logo-carousel-track {
    /* 'flex' is already applied via Tailwind class `flex` */
    /* 'display: flex;' */
    will-change: transform; /* Hint to browser for optimization */
  }

  .logo-item {
    flex-shrink: 0; /* Prevent items from shrinking */
    width: 10rem; /* 160px, Tailwind w-40. Adjust as needed */
    display: flex; /* For centering content within the item */
    align-items: center;
    justify-content: center;
    padding: 0.5rem; /* Tailwind p-2. For space around the logo within its box */
    box-sizing: border-box;
  }

  .logo-item a {
    display: flex; /* Ensure anchor fills the item for centering */
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  .logo-item svg,
  .logo-item img {
    /* If you ever use <img> tags for logos */
    max-width: 100%;
    max-height: 2.5rem; /* 40px, Tailwind max-h-10. Adjust as needed */
    object-fit: contain; /* Maintain aspect ratio */
  }
</style>
