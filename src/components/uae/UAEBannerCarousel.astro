---
// Carousel of UAE landing banners using Swiper
import UAEBanner from '@components/uae/UAEBanner.astro';
import UAELinkCardBanner from '@components/uae/UAELinkCardBanner.astro';
import UAERecipientsBanner from '@components/uae/UAERecipientsBanner.astro';

// Swiper styles
import 'swiper/css/bundle';

const { bannerCarousel } = Astro.locals.translations;
---

<section class='swiper mySwiper'>
  <div class='swiper-wrapper'>
    <!-- Slide 1: Transaction cards banner -->
    <div class='flex items-center justify-center w-full swiper-slide'>
      <UAEBanner
        heading={bannerCarousel?.slides?.[0]?.heading || 'Send money abroad instantly'}
        description={bannerCarousel?.slides?.[0]?.description ||
          'Compare rates, choose your provider, and send money to your loved ones instantly with Jingle Pay.'}
      />
    </div>

    <!-- Slide 2: Link card & add fund -->
    <div class='flex items-center justify-center w-full swiper-slide'>
      <UAELinkCardBanner />
    </div>

    <!-- Slide 3: Recipients & Split -->
    <div class='flex items-center justify-center w-full swiper-slide'>
      <UAERecipientsBanner />
    </div>
  </div>

  <!-- Pagination dots -->
  <div class='inline-flex justify-start items-center gap-3.5 absolute bottom-8 left-1/2 -translate-x-1/2 z-10'>
    <div id='dot-0' class='w-4 h-4 bg-white rounded-full custom-pagination-dot active'></div>
    <div id='dot-1' data-active='False' class='relative w-3 h-3 opacity-50 custom-pagination-dot'>
      <div class='absolute top-0 left-0 w-3 h-3 rounded-full bg-zinc-400'></div>
    </div>
    <div id='dot-2' data-active='False' class='relative w-3 h-3 opacity-50 custom-pagination-dot'>
      <div class='absolute top-0 left-0 w-3 h-3 rounded-full bg-zinc-400'></div>
    </div>
  </div>

  <!-- Swiper init script -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Import Swiper with its type
        const { default: Swiper } = await import('swiper');
        // Type import for SwiperCore
        type SwiperType = typeof Swiper & { realIndex: number };
        const { Autoplay } = await import('swiper/modules');

        // Get custom pagination dots
        const dots = [
          document.getElementById('dot-0'),
          document.getElementById('dot-1'),
          document.getElementById('dot-2'),
        ].filter((dot): dot is HTMLElement => dot !== null); // Filter out null elements

        // Function to update active dot
        const updateActiveDot = (index: number) => {
          // Reset all dots
          dots.forEach((dot, i) => {
            if (i === index) {
              // Active dot
              dot.classList.remove('opacity-50');
              dot.classList.add('w-4', 'h-4', 'bg-white', 'rounded-full');
              dot.classList.remove('w-3', 'h-3');
              dot.setAttribute('data-active', 'True');
              // Remove inner div if it exists
              if (dot.firstElementChild) {
                dot.innerHTML = '';
              }
            } else {
              // Inactive dots
              dot.classList.add('opacity-50');
              dot.classList.add('w-3', 'h-3', 'rounded-full');
              dot.classList.remove('w-4', 'h-4', 'bg-white');
              dot.setAttribute('data-active', 'False');
              // Add inner div if it doesn't exist
              if (!dot.firstElementChild) {
                dot.innerHTML = '<div class="absolute top-0 left-0 w-3 h-3 rounded-full bg-zinc-400"></div>';
              }
            }
          });
        };

        // Add click event listeners to dots
        dots.forEach((dot, i) => {
          dot.addEventListener('click', () => {
            swiper.slideTo(i);
          });
        });

        const swiper = new Swiper('.mySwiper', {
          modules: [Autoplay],
          loop: true,
          slidesPerView: 1,
          spaceBetween: 0,
          grabCursor: true,
          // autoplay: {
          //   delay: 4000,
          //   disableOnInteraction: false,
          // },
          on: {
            init: function() {
              updateActiveDot(0);
            },
            slideChange: function(this: SwiperType) {
              updateActiveDot(this.realIndex);
            }
          },
        });
      } catch (error) {
        console.error('Error initializing UAE banner Swiper:', error);
      }
    });
  </script>
</section>
