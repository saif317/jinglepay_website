---
import { Image } from 'astro:assets';

import arrow from '@assets/icons/arrow.svg';

const faqData: { question: string; answer: string }[] = [
  {
    question: 'What is Branchless Banking?',
    answer:
      'Branchless Banking refers to financial services provided without the need for physical bank branches. It allows users to perform transactions like deposits, withdrawals, transfers, and bill payments through mobile phones or agents.',
  },
  {
    question: 'How do I register for Branchless Banking?',
    answer:
      "To register for Branchless Banking, you typically need to download the bank's mobile app or visit an authorized agent. Follow the on-screen instructions or agent guidance, which usually involve providing personal details and setting up security credentials.",
  },
  {
    question: 'What are the benefits of using Branchless Banking?',
    answer:
      'Benefits include convenience (banking anytime, anywhere), accessibility (reaching underserved areas), potentially lower transaction costs, and reduced need to visit physical branches, saving time and travel expenses.',
  },
  {
    question: 'What types of services can I avail through Branchless Banking?',
    answer:
      'Common services include balance inquiries, mini-statements, fund transfers (within the bank or to other banks), bill payments (utilities, mobile recharge), cash deposits/withdrawals (via agents), and sometimes loan applications or account opening.',
  },
  {
    question: 'How can I deposit money into my Branchless Banking account?',
    answer:
      'You can usually deposit money through authorized agents, direct bank transfers from other accounts, or sometimes via specific ATM functionalities.',
  },
  {
    question: 'How do I withdraw money from my Branchless Banking account?',
    answer:
      'Withdrawals are typically done through authorized agents by generating a withdrawal code on your app/phone, or sometimes via cardless ATM withdrawals if supported.',
  },
  {
    question: 'Are there any fees associated with Branchless Banking services?',
    answer:
      "Some transactions might have associated fees (e.g., transfers to other banks, agent cash-out fees). Check the specific bank's schedule of charges for details.",
  },
  {
    question: 'Is Branchless Banking secure?',
    answer:
      'Reputable Branchless Banking services use security measures like PINs, OTPs (One-Time Passwords), and encryption. However, users must also practice safe habits like protecting their PIN and not sharing credentials.',
  },
  {
    question: 'Can I transfer money to other banks using Branchless Banking?',
    answer:
      'Yes, most Branchless Banking platforms support inter-bank fund transfers through systems like NEFT, IMPS, or UPI, depending on the region and platform.',
  },
  {
    question: 'What do I do if I lose my mobile phone or forget my PIN?',
    answer:
      "Immediately contact your bank's customer support to block your Branchless Banking account or service associated with the lost phone. They will guide you on the process to reset your PIN or regain access securely.",
  },
  {
    question: 'Can I access Branchless Banking on my computer?',
    answer:
      'Some banks offer web-based portals for their digital banking services which might overlap with Branchless Banking features. However, many Branchless Banking services are primarily mobile-app or USSD based.',
  },
  {
    question: 'How do I check my account balance?',
    answer:
      'You can usually check your balance directly through the mobile app, via USSD codes on your phone, or by requesting a mini-statement.',
  },
  {
    question: 'What should I do if my transaction fails?',
    answer:
      'Check if the amount was debited from your account. If debited but the transaction failed, the amount is usually auto-reversed within a specific timeframe (e.g., 24-72 hours). If not reversed, contact customer support with the transaction details.',
  },
  {
    question: 'Is there a minimum balance requirement for Branchless Banking accounts?',
    answer:
      'This depends on the specific type of account linked to the Branchless Banking service. Some basic savings accounts offered might have zero or low minimum balance requirements. Check with your bank.',
  },
  {
    question: 'How can I close my Branchless Banking account?',
    answer:
      "You typically need to contact your bank's customer support or visit a branch (if applicable) to formally request account closure. Ensure all dues are clear before closing.",
  },
];
---

<section
  class='flex flex-col pt-[104px] pb-[80px] px-4 lg:px-[88px] lg:pt-[189px] lg:pb-[161px] gap-y-12 lg:gap-y-[65px]'
  aria-labelledby='faq-heading'
>
  <div class='flex flex-row items-center gap-x-4'>
    <button onclick='history.back(); return false;' role='button' style='cursor: pointer;'>
      <div class='w-8 h-8 p-1.5 flex items-center justify-center border rounded-full border-[#794EFF]'>
        <Image src={arrow} alt='Arrow' class='rotate-180' />
      </div>
    </button>
    <span class='text-3xl font-extrabold lg:text-4xl'>Frequent Answered Questions</span>
  </div>

  <div class='border-t border-gray-200'>
    {
      faqData.map((item, index: number) => (
        <div class='border-b border-gray-200 faq-item'>
          <button
            class='flex items-center justify-between w-full px-2 py-5 text-base font-bold text-left text-gray-800 faq-question focus:outline-none focus-visible:ring focus-visible:ring-indigo-300 focus-visible:ring-opacity-75 group'
            aria-expanded='false'
            aria-controls={`faq-answer-${index}`}
            id={`faq-question-${index}`}
          >
            <span class='flex-grow mr-4'>{item.question}</span>
            <span class='flex-shrink-0 text-gray-500 transition-transform duration-300 ease-in-out transform faq-icon-wrapper group-focus:text-indigo-600'>
              <svg class='w-4 h-4' xmlns='http://www.w3.org/2000/svg' fill='currentColor' viewBox='0 0 16 16'>
                <path
                  fill-rule='evenodd'
                  d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'
                />
              </svg>
            </span>
          </button>
          <div
            class='faq-answer overflow-hidden max-h-0 transition-[max-height,padding] duration-400 ease-in-out px-2'
            role='region'
            aria-labelledby={`faq-question-${index}`}
            id={`faq-answer-${index}`}
          >
            <div class='pt-1 pb-5'>
              <p class='text-base leading-relaxed text-gray-600'>{item.answer}</p>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item) => {
      const questionButton = item.querySelector('.faq-question');
      const answerPanel: HTMLElement | null = item.querySelector('.faq-answer');
      const iconWrapper = item.querySelector('.faq-icon-wrapper'); // Target the wrapper

      if (!questionButton || !answerPanel || !iconWrapper) return;
      questionButton.addEventListener('click', () => {
        const isExpanded = questionButton.getAttribute('aria-expanded') === 'true';
        const currentMaxHeight = answerPanel.style.maxHeight;

        // --- Optional: Close all others when one opens ---
        // document.querySelectorAll('.faq-item').forEach(otherItem => {
        //     if (otherItem !== item) {
        //         const otherButton = otherItem.querySelector('.faq-question');
        //         const otherAnswer = otherItem.querySelector('.faq-answer');
        //         const otherIconWrapper = otherItem.querySelector('.faq-icon-wrapper');
        //         if (otherButton && otherAnswer && otherIconWrapper && otherButton.getAttribute('aria-expanded') === 'true') {
        //             otherButton.setAttribute('aria-expanded', 'false');
        //             otherAnswer.style.maxHeight = '0px';
        //             otherIconWrapper.classList.remove('rotate-180', 'text-indigo-600'); // Reset icon state
        //              otherIconWrapper.classList.add('text-gray-500');
        //         }
        //     }
        // });
        // --- End Optional ---

        // Toggle the current item
        questionButton.setAttribute('aria-expanded', String(!isExpanded));

        if (isExpanded) {
          // Closing: Set max-height to 0
          answerPanel.style.maxHeight = '0px';
          iconWrapper.classList.remove('rotate-180', 'text-indigo-600'); // Use your "open" color
          iconWrapper.classList.add('text-gray-500'); // Reset to default color
        } else {
          // Opening: Set max-height to scrollHeight for dynamic content height
          // Add a small delay to allow CSS transition to catch the change from 0
          // requestAnimationFrame(() => {
          answerPanel.style.maxHeight = answerPanel.scrollHeight + 'px';
          // });
          iconWrapper.classList.add('rotate-180', 'text-indigo-600'); // Example open color
          iconWrapper.classList.remove('text-gray-500');
        }
      });

      // Optional: Recalculate max-height on resize for open accordions
      window.addEventListener('resize', () => {
        if (questionButton.getAttribute('aria-expanded') === 'true') {
          // Temporarily remove transition to instantly set height, then re-apply
          const transition = answerPanel.style.transition;
          answerPanel.style.transition = 'none'; // Disable transition for recalc
          answerPanel.style.maxHeight = answerPanel.scrollHeight + 'px';
          // Force reflow/repaint before re-enabling transition
          answerPanel.offsetHeight;
          answerPanel.style.transition = transition; // Restore transition
        }
      });
    });
  });
</script>
